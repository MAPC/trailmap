{% extends "base.html" %}
{% load i18n %}
{% load disqus_tags %}

{% block javascript %}
	
	<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.validate.min.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}js/ol/OpenLayers.js"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
	<script type="text/javascript" src="{{ STATIC_URL }}js/cloudmade.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}js/main.js"></script>
	
	<script type="text/javascript">
		
		$(document).ready(function() {
			
			{% if form %}
			
			$.trailmap.map.removeLayer($.trailmap.layer.markers);
			$.trailmap.staticurl = "{{ STATIC_URL }}";
			
			var edit_marker = new OpenLayers.LonLat({{ feedback.location.x }},{{ feedback.location.y }}).transform($.trailmap.proj.wgs84, $.trailmap.proj.osm);
			$.trailmap.feedbackMarker(edit_marker.lon, edit_marker.lat);
			$.trailmap.map.setCenter( edit_marker, $.trailmap.zoom );
			
			{% else %}
			
        	$.trailmap.lon = {{ feedback.location.x }};
			$.trailmap.lat = {{ feedback.location.y }};
			$.trailmap.zoom = 14;
        	
            $.trailmap.addMarker(new OpenLayers.LonLat({{ feedback.location.x }},{{ feedback.location.y }}).transform($.trailmap.proj.wgs84, $.trailmap.proj.osm), "{{ feedback.description }}");

			$.trailmap.layer.markers.setVisibility({
	        	visibility: true
	        });

			$.trailmap.map.setCenter( new OpenLayers.LonLat($.trailmap.lon, $.trailmap.lat).transform($.trailmap.proj.wgs84, $.trailmap.proj.osm), $.trailmap.zoom );
			
			{% endif %}
          
        });
    </script> 
	
{% endblock %}
	
{% block map %}
		
		<div id="map_canvas"></div>
		
		<ul id="map_legend">			
			<li><img src="{{ STATIC_URL }}img/ct.png" alt="icon" />Cycle track</li>
			<li><img src="{{ STATIC_URL }}img/bl.png" alt="icon" />Bike lane</li>
			<li><img src="{{ STATIC_URL }}img/sl.png" alt="icon" />Shared lane</li>
			<li><img src="{{ STATIC_URL }}img/or.png" alt="icon" />On-road route</li>
			<li><img src="{{ STATIC_URL }}img/e.png" alt="icon" />Improved path</li>
			<li><img src="{{ STATIC_URL }}img/u.png" alt="icon" />Unimproved path</li>
			<li><img src="{{ STATIC_URL }}img/t.png" alt="icon" />Walking path or trail</li>
			<li><img src="{{ STATIC_URL }}img/w.png" alt="icon" />Water trail</li>
			<li><img src="{{ STATIC_URL }}img/lw.png" alt="icon" />Regional or local walking trail</li>
			<li><img src="{{ STATIC_URL }}img/lb.png" alt="icon" />Regional bicycle route</li>
			<li><img src="{{ STATIC_URL }}img/p.png" alt="icon" />Proposed facility</li>
		</ul>
		
{% endblock %}
		
{% block body %}

		<div id="content" class="prepend-2 span-20 append-2 prepend-top last">
			
			{% if form %}
			
			<form id="feedbackform_admin" action="/feedback/{{ feedback.id }}/update/" method="post">
	
				{% csrf_token %}
					
				<div>Please drag the yellow marker <img src="{{ STATIC_URL }}js/ol/img/marker-gold.png" height="18" alt="blue marker" /> to to adjust the location and use the form below to edit your feedback:</div>
				
				{{ form.location }}
				
				<div class="form-row">
					{{ form.description }}
				</div>
				
				<div class="form-row">
					<span class="label">Your name (optional):</span> {{ form.user_name }}
				</div>
				
				<div class="form-row">
					<span class="label">Your email (optional):</span> {{ form.user_email }}
				</div>
				
				<div class="form-row">
					<span class="label">{{ MATH_CAPTCHA_QUESTION }}</span> {{ form.math_captcha_field }}
				</div>
		
				<input type="submit" value="Edit Feedback" />
			
			</form>
					
			{% else %}
			
			<p>{% if feedback.user_name %}<strong>{{ feedback.user_name }}</strong>: {% endif %}{{ feedback.description }}</p>
			
			{% endif %}
			
			{% set_disqus_identifier "feedback_" feedback.id %}
			{% set_disqus_url "http://trailmap.mapc.org" feedback.get_absolute_url %}
			{% set_disqus_title "Feedback-" feedback.id %}
			
			{% disqus_show_comments %}
			
			<p id="disclaimer" class="prepend-top">Disclaimer: 
				The data herein is provided as is and for information purposes only. MAPC does not guarantee its completeness or accuracy. 
				This project is a work in progress. Weather, traffic, construction or other events out of MAPCâ€™s control may affect the utility 
				of the data provided. Plan accordingly and use caution, obey all applicable laws and follow generally accepted practices when 
				using these facilities.</p>

		</div>

{% endblock %}
